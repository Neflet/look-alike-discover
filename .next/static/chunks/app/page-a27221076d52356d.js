(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[931],{5830:function(e,t,a){Promise.resolve().then(a.bind(a,6331))},6331:function(e,t,a){"use strict";a.d(t,{ImageSearch:function(){return eE}});var r=a(7437),s=a(2265),n=a(3145),i=a(9322),l=a(2489);let o=0,c=new Map,d=e=>{if(c.has(e))return;let t=setTimeout(()=>{c.delete(e),g({type:"REMOVE_TOAST",toastId:e})},1e6);c.set(e,t)},u=(e,t)=>{switch(t.type){case"ADD_TOAST":return{...e,toasts:[t.toast,...e.toasts].slice(0,1)};case"UPDATE_TOAST":return{...e,toasts:e.toasts.map(e=>e.id===t.toast.id?{...e,...t.toast}:e)};case"DISMISS_TOAST":{let{toastId:a}=t;return a?d(a):e.toasts.forEach(e=>{d(e.id)}),{...e,toasts:e.toasts.map(e=>e.id===a||void 0===a?{...e,open:!1}:e)}}case"REMOVE_TOAST":if(void 0===t.toastId)return{...e,toasts:[]};return{...e,toasts:e.toasts.filter(e=>e.id!==t.toastId)}}},h=[],m={toasts:[]};function g(e){m=u(m,e),h.forEach(e=>{e(m)})}function x(e){let{...t}=e,a=(o=(o+1)%Number.MAX_SAFE_INTEGER).toString(),r=()=>g({type:"DISMISS_TOAST",toastId:a});return g({type:"ADD_TOAST",toast:{...t,id:a,open:!0,onOpenChange:e=>{e||r()}}}),{id:a,dismiss:r,update:e=>g({type:"UPDATE_TOAST",toast:{...e,id:a}})}}function p(){let[e,t]=s.useState(m);return s.useEffect(()=>(h.push(t),()=>{let e=h.indexOf(t);e>-1&&h.splice(e,1)}),[e]),{...e,toast:x,dismiss:e=>g({type:"DISMISS_TOAST",toastId:e})}}let f=(0,a(1545).eI)("https://veikyjfcycgpkpwdbksa.supabase.co","eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InZlaWt5amZjeWNncGtwd2Ria3NhIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTQwMjA0OTAsImV4cCI6MjA2OTU5NjQ5MH0.xPFTAJVSpVS4hcbnzmILDItpSphcP2aKTPSFo1VbB2s");async function b(){let{data:e,error:t}=await f.rpc("get_brands");return t?(console.error("[RPC] get_brands error",t),[]):(null!=e?e:[]).map(e=>e.brand).filter(Boolean)}function v(e,t){if(!Array.isArray(e)||1152!==e.length)throw console.error("[embed] bad shape",{len:null==e?void 0:e.length,model:t}),Error("Embedding must be length 1152")}async function j(e){try{console.log("[EMBED-FN] downscaling image if needed, then converting to base64");let t=await w(e),a=await new Promise((e,a)=>{let r=new FileReader;r.onload=()=>{let t=r.result;e(t.includes(",")?t.split(",")[1]:t)},r.onerror=a,r.readAsDataURL(t)}),r=await fetch("/api/embed",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({inputs:a})});if(r.ok){let e=(await r.json()).embedding,t=(null==e?void 0:e.length)||1152,a="google/siglip-so400m-patch14-384";if(v(e,a),1152!==t)throw Error("Unexpected dim ".concat(t));return console.log("[EMBED-FN] /api/embed ok",{len:e.length,model:a}),{embedding:e,dim:t,model:a}}{let e=await r.json().catch(()=>({error:"Unknown error"}));throw Error(e.error||"Embedding failed")}}catch(e){console.log("[EMBED-FN] /api/embed failed, trying edge function:",e)}let t=new FormData;t.append("file",e),console.log("[EMBED-FN] invoking embed-image edge function…");let{data:a,error:r}=await f.functions.invoke("embed-image",{body:t});if(r)throw r;let{embedding:s,dim:n,model:i}=a;if(v(s,i),1152!==n)throw Error("Unexpected dim ".concat(n));return console.log("[EMBED-FN] ok",{len:s.length,model:i}),a}async function w(e){if(e.size<2097152||!window.Image||!document.createElement)return e;try{return new Promise((t,a)=>{let r=new Image,s=document.createElement("canvas"),n=s.getContext("2d");if(!n){t(e);return}r.onload=()=>{let a=r.width,i=r.height;a>i?a>768&&(i=768*i/a,a=768):i>768&&(a=768*a/i,i=768),s.width=a,s.height=i,n.drawImage(r,0,0,a,i),s.toBlob(a=>{if(!a){t(e);return}let r=new File([a],e.name,{type:"image/jpeg",lastModified:Date.now()});t(r)},"image/jpeg",.7)},r.onerror=()=>t(e),r.src=URL.createObjectURL(e)})}catch(t){return e}}async function y(e,t){var a,r;let s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};v(e,t);let n=null!==(a=s.topK)&&void 0!==a?a:5,i=null!==(r=s.minSimilarity)&&void 0!==r?r:.55;console.log("[RPC] calling search_products_siglip",{top_k:n,model:t});let{data:l,error:o}=await f.rpc("search_products_siglip",{qvec:e,p_model_id:t,top_k:n});if(o)throw console.error("[RPC] error",o),o;let c=(null!=l?l:[]).filter(e=>"number"!=typeof e.similarity||e.similarity>=i);return console.log("[RPC] results",c.length),c}async function N(e,t){var a,r,s,n,i,l,o;let c=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};v(e,t);let d=null!==(a=c.topK)&&void 0!==a?a:24,u=null!==(r=c.minSimilarity)&&void 0!==r?r:.55,h={qvec:e,p_model_id:t,top_k:d,price_min:"number"==typeof c.priceMin?c.priceMin:null,price_max:"number"==typeof c.priceMax?c.priceMax:null,brand_eq:c.brand&&c.brand.trim()?c.brand.trim():null};console.log("[RPC] calling search_products_filtered with params:",{top_k:h.top_k,price_min:null!==(s=h.price_min)&&void 0!==s?s:"null",price_max:null!==(n=h.price_max)&&void 0!==n?n:"null",brand_eq:null!==(i=h.brand_eq)&&void 0!==i?i:"null"});let{data:m,error:g}=await f.rpc("search_products_filtered",h);if(g){if(console.error("[RPC] filtered error",g),(null===(l=g.message)||void 0===l?void 0:l.includes("function"))||(null===(o=g.message)||void 0===o?void 0:o.includes("does not exist")))throw Error("Database function not found. Please run the migration: supabase db push");throw g}let x=(null!=m?m:[]).filter(e=>"number"!=typeof e.similarity||e.similarity>=u);return console.log("[RPC] filtered results",x.length),x}var k=a(781);async function S(){try{let{data:{user:e}}=await k.O.auth.getUser();return(null==e?void 0:e.id)||null}catch(e){return null}}async function _(e,t){try{let a=await S(),r=function(){let e=sessionStorage.getItem("sessionId");if(e)return e;let t="session_".concat(Date.now(),"_").concat(Math.random().toString(36).substr(2,9));return sessionStorage.setItem("sessionId",t),t}(),{error:s}=await k.O.rpc("track_analytics_event",{p_user_id:a,p_session_id:r,p_event_type:e,p_event_data:t||{},p_page_url:window.location.href,p_user_agent:navigator.userAgent});s&&console.error("Analytics tracking error:",s)}catch(e){console.error("Track event error:",e)}}var C=a(3298),I=a(2595),z=a(5905),E=a(9076);async function M(e,t){return new Promise((a,r)=>{let s=new Image;s.onload=()=>{let n=document.createElement("canvas"),i=n.getContext("2d");if(!i){r(Error("Could not get canvas context"));return}n.width=t.width,n.height=t.height,i.drawImage(s,t.x,t.y,t.width,t.height,0,0,t.width,t.height),n.toBlob(t=>{if(!t){r(Error("Failed to create blob from canvas"));return}a(new File([t],e.name,{type:e.type||"image/jpeg",lastModified:Date.now()}))},e.type||"image/jpeg",.92)},s.onerror=()=>r(Error("Failed to load image")),s.src=URL.createObjectURL(e)})}function R(e){let{imageFile:t,imageUrl:a,onCropComplete:n,onCancel:i}=e,[l,o]=(0,s.useState)(null),[c,d]=(0,s.useState)(null),[u,h]=(0,s.useState)(null),[m,g]=(0,s.useState)(null),[x,p]=(0,s.useState)(null),[f,b]=(0,s.useState)(null),v=(0,s.useRef)(null),j=(0,s.useRef)(null);(0,s.useEffect)(()=>{let e=new Image;e.onload=()=>{p({width:e.width,height:e.height})},e.src=a},[a]),(0,s.useEffect)(()=>{let e=()=>{if(v.current){let e=v.current.getBoundingClientRect();b({width:e.width,height:e.height})}};return e(),window.addEventListener("resize",e),()=>window.removeEventListener("resize",e)},[x]),(0,s.useEffect)(()=>{if(f&&x&&!l){let e=f.width/x.width,t=f.height/x.height,a=.2*f.width;o({x:a/e,y:.2*f.height/t,width:.6*f.width/e,height:.6*f.height/t})}},[f,x,l]);let w=function(e,t,a){let r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:6,s=r*Math.max(x.width/f.width,x.height/f.height),n=a.x,i=a.x+a.width,l=a.y,o=a.y+a.height;return Math.abs(e-n)<s&&Math.abs(t-l)<s?"nw":Math.abs(e-i)<s&&Math.abs(t-l)<s?"ne":Math.abs(e-n)<s&&Math.abs(t-o)<s?"sw":Math.abs(e-i)<s&&Math.abs(t-o)<s?"se":Math.abs(e-n)<s&&t>=l&&t<=o?"w":Math.abs(e-i)<s&&t>=l&&t<=o?"e":Math.abs(t-l)<s&&e>=n&&e<=i?"n":Math.abs(t-o)<s&&e>=n&&e<=i?"s":e>=n&&e<=i&&t>=l&&t<=o?"move":null},y=e=>{c&&e.currentTarget instanceof HTMLElement&&e.currentTarget.releasePointerCapture(e.pointerId),d(null),h(null),g(null)},N=async()=>{if(l&&x){if(l.width<10||l.height<10){alert("Crop area too small. Please select a larger area.");return}try{let e=await M(t,l);n(e)}catch(e){console.error("Crop error:",e),alert("Failed to crop image. Please try again.")}}};return x?(0,r.jsx)("div",{className:"min-h-screen flex flex-col items-center justify-center px-6 py-24",children:(0,r.jsxs)("div",{className:"w-full max-w-4xl space-y-6",children:[(0,r.jsxs)("div",{className:"text-center space-y-2",children:[(0,r.jsx)("h2",{className:"text-2xl font-bold tracking-tight",children:"Select Area to Search"}),(0,r.jsx)("p",{className:"text-sm opacity-60",children:"Drag to move or resize the selection box"})]}),(0,r.jsx)("div",{ref:j,className:"relative border-2 border-foreground/20 rounded-lg overflow-hidden bg-background crop-container",style:{cursor:(()=>{if(!c)return"default";switch(c){case"move":return"move";case"n":case"s":return"ns-resize";case"e":case"w":return"ew-resize";case"ne":case"sw":return"nesw-resize";case"nw":case"se":return"nwse-resize";default:return"default"}})(),maxHeight:"70vh",touchAction:"none",userSelect:"none"},children:(0,r.jsxs)("div",{className:"relative inline-block",children:[(0,r.jsx)("img",{ref:v,src:a,alt:"Crop preview",className:"max-w-full max-h-[70vh] object-contain",draggable:!1,style:{touchAction:"none",pointerEvents:"auto"},onPointerDown:e=>{if(!v.current||!j.current||!f||!x||!l)return;e.preventDefault(),e.stopPropagation();let t=v.current.getBoundingClientRect(),a=e.clientX-t.left,r=e.clientY-t.top;if(a<0||r<0||a>t.width||r>t.height)return;let s=x.width/f.width,n=x.height/f.height,i=a*s,o=r*n,c=w(i,o,l);if(c&&(d(c),h({x:i,y:o}),g({...l}),e.currentTarget instanceof HTMLElement))try{e.currentTarget.setPointerCapture(e.pointerId)}catch(e){console.warn("setPointerCapture failed:",e)}},onPointerMove:e=>{if(!c||!u||!m||!x||!f||!v.current)return;e.preventDefault();let t=v.current.getBoundingClientRect(),a=Math.max(0,Math.min(e.clientX-t.left,t.width)),r=Math.max(0,Math.min(e.clientY-t.top,t.height)),s=x.width/f.width,n=x.height/f.height,i=a*s-u.x,l=r*n-u.y,d={...m};if("move"===c)d.x=Math.max(0,Math.min(m.x+i,x.width-m.width)),d.y=Math.max(0,Math.min(m.y+l,x.height-m.height));else{if(c.includes("w")){let e=Math.max(0,Math.min(m.x+i,m.x+m.width-10)),t=m.width-(e-m.x);d.x=e,d.width=t}if(c.includes("e")&&(d.width=Math.max(10,Math.min(m.width+i,x.width-m.x))),c.includes("n")){let e=Math.max(0,Math.min(m.y+l,m.y+m.height-10)),t=m.height-(e-m.y);d.y=e,d.height=t}c.includes("s")&&(d.height=Math.max(10,Math.min(m.height+l,x.height-m.y))),d.x=Math.max(0,Math.min(d.x,x.width-d.width)),d.y=Math.max(0,Math.min(d.y,x.height-d.height)),d.width=Math.min(d.width,x.width-d.x),d.height=Math.min(d.height,x.height-d.y)}o(d)},onPointerUp:y,onPointerCancel:y}),l&&l.width>0&&l.height>0&&f&&x&&(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)("div",{className:"absolute inset-0 pointer-events-none bg-black/50",style:{clipPath:"polygon(\n                      0% 0%, \n                      0% 100%, \n                      ".concat(l.x/x.width*100,"% 100%, \n                      ").concat(l.x/x.width*100,"% ").concat(l.y/x.height*100,"%, \n                      ").concat((l.x+l.width)/x.width*100,"% ").concat(l.y/x.height*100,"%, \n                      ").concat((l.x+l.width)/x.width*100,"% ").concat((l.y+l.height)/x.height*100,"%, \n                      ").concat(l.x/x.width*100,"% ").concat((l.y+l.height)/x.height*100,"%, \n                      ").concat(l.x/x.width*100,"% 100%, \n                      100% 100%, \n                      100% 0%\n                    )")}}),(0,r.jsxs)("div",{className:"absolute border-2 border-foreground",style:{left:"".concat(l.x/x.width*100,"%"),top:"".concat(l.y/x.height*100,"%"),width:"".concat(l.width/x.width*100,"%"),height:"".concat(l.height/x.height*100,"%"),pointerEvents:"none"},children:[(0,r.jsx)("div",{className:"absolute -top-1.5 -left-1.5 w-3 h-3 bg-background border-2 border-foreground rounded-sm cursor-nwse-resize z-10",style:{pointerEvents:"auto"},onPointerDown:e=>{e.stopPropagation();let t=v.current.getBoundingClientRect(),a=e.clientX-t.left,r=e.clientY-t.top,s=x.width/f.width,n=x.height/f.height;d("nw"),h({x:a*s,y:r*n}),g({...l}),e.currentTarget.setPointerCapture(e.pointerId)}}),(0,r.jsx)("div",{className:"absolute -top-1.5 -right-1.5 w-3 h-3 bg-background border-2 border-foreground rounded-sm cursor-nesw-resize z-10",style:{pointerEvents:"auto"},onPointerDown:e=>{e.stopPropagation();let t=v.current.getBoundingClientRect(),a=e.clientX-t.left,r=e.clientY-t.top,s=x.width/f.width,n=x.height/f.height;d("ne"),h({x:a*s,y:r*n}),g({...l}),e.currentTarget.setPointerCapture(e.pointerId)}}),(0,r.jsx)("div",{className:"absolute -bottom-1.5 -left-1.5 w-3 h-3 bg-background border-2 border-foreground rounded-sm cursor-nesw-resize z-10",style:{pointerEvents:"auto"},onPointerDown:e=>{e.stopPropagation();let t=v.current.getBoundingClientRect(),a=e.clientX-t.left,r=e.clientY-t.top,s=x.width/f.width,n=x.height/f.height;d("sw"),h({x:a*s,y:r*n}),g({...l}),e.currentTarget.setPointerCapture(e.pointerId)}}),(0,r.jsx)("div",{className:"absolute -bottom-1.5 -right-1.5 w-3 h-3 bg-background border-2 border-foreground rounded-sm cursor-nwse-resize z-10",style:{pointerEvents:"auto"},onPointerDown:e=>{e.stopPropagation();let t=v.current.getBoundingClientRect(),a=e.clientX-t.left,r=e.clientY-t.top,s=x.width/f.width,n=x.height/f.height;d("se"),h({x:a*s,y:r*n}),g({...l}),e.currentTarget.setPointerCapture(e.pointerId)}}),(0,r.jsx)("div",{className:"absolute -top-1.5 left-1/2 -translate-x-1/2 w-3 h-3 bg-background border-2 border-foreground rounded-sm cursor-ns-resize z-10",style:{pointerEvents:"auto"},onPointerDown:e=>{e.stopPropagation();let t=v.current.getBoundingClientRect(),a=e.clientX-t.left,r=e.clientY-t.top,s=x.width/f.width,n=x.height/f.height;d("n"),h({x:a*s,y:r*n}),g({...l}),e.currentTarget.setPointerCapture(e.pointerId)}}),(0,r.jsx)("div",{className:"absolute -bottom-1.5 left-1/2 -translate-x-1/2 w-3 h-3 bg-background border-2 border-foreground rounded-sm cursor-ns-resize z-10",style:{pointerEvents:"auto"},onPointerDown:e=>{e.stopPropagation();let t=v.current.getBoundingClientRect(),a=e.clientX-t.left,r=e.clientY-t.top,s=x.width/f.width,n=x.height/f.height;d("s"),h({x:a*s,y:r*n}),g({...l}),e.currentTarget.setPointerCapture(e.pointerId)}}),(0,r.jsx)("div",{className:"absolute -left-1.5 top-1/2 -translate-y-1/2 w-3 h-3 bg-background border-2 border-foreground rounded-sm cursor-ew-resize z-10",style:{pointerEvents:"auto"},onPointerDown:e=>{e.stopPropagation();let t=v.current.getBoundingClientRect(),a=e.clientX-t.left,r=e.clientY-t.top,s=x.width/f.width,n=x.height/f.height;d("w"),h({x:a*s,y:r*n}),g({...l}),e.currentTarget.setPointerCapture(e.pointerId)}}),(0,r.jsx)("div",{className:"absolute -right-1.5 top-1/2 -translate-y-1/2 w-3 h-3 bg-background border-2 border-foreground rounded-sm cursor-ew-resize z-10",style:{pointerEvents:"auto"},onPointerDown:e=>{e.stopPropagation();let t=v.current.getBoundingClientRect(),a=e.clientX-t.left,r=e.clientY-t.top,s=x.width/f.width,n=x.height/f.height;d("e"),h({x:a*s,y:r*n}),g({...l}),e.currentTarget.setPointerCapture(e.pointerId)}})]})]})]})}),(0,r.jsxs)("div",{className:"flex items-center justify-center gap-4",children:[(0,r.jsxs)(I.z,{onClick:N,disabled:!l||l.width<10||l.height<10,className:"h-12 px-8 text-xs tracking-[0.2em] uppercase",children:[(0,r.jsx)(z.Z,{className:"w-4 h-4 mr-2"}),"Search Selected Area"]}),(0,r.jsx)(I.z,{onClick:()=>{n(t)},variant:"outline",className:"h-12 px-8 text-xs tracking-[0.2em] uppercase",children:"Search Entire Image"}),(0,r.jsxs)(I.z,{onClick:i,variant:"ghost",className:"h-12 px-8 text-xs tracking-[0.2em] uppercase",children:[(0,r.jsx)(E.Z,{className:"w-4 h-4 mr-2"}),"Cancel"]})]}),l&&l.width>0&&l.height>0&&(0,r.jsxs)("div",{className:"text-center text-xs opacity-60",children:["Selection: ",Math.round(l.width*l.height/(x.width*x.height)*100),"% of image"]})]})}):(0,r.jsx)("div",{className:"min-h-screen flex items-center justify-center",children:(0,r.jsx)("div",{className:"text-center",children:"Loading image..."})})}function P(e){let{isOpen:t,onClose:a,lastEmbedding:n,lastModel:i,onResults:l}=e,[o,c]=(0,s.useState)(""),[d,u]=(0,s.useState)([]),[h,m]=(0,s.useState)(""),[g,x]=(0,s.useState)(""),[p,f]=(0,s.useState)(!1),[v,j]=(0,s.useState)(!1),[w,y]=(0,s.useState)(null);if((0,s.useEffect)(()=>{t&&0===d.length&&(j(!0),b().then(u).catch(e=>{console.error("[RefineSearch] Failed to load brands:",e)}).finally(()=>j(!1)))},[t,d.length]),!t)return null;async function k(){if(!n||!i){y("No base query available. Upload an image first.");return}let e=h.trim()?Number(h.trim()):void 0,t=g.trim()?Number(g.trim()):void 0;if(h.trim()&&(isNaN(e)||e<0)){y("Min price must be a valid number");return}if(g.trim()&&(isNaN(t)||t<0)){y("Max price must be a valid number");return}if(void 0!==e&&void 0!==t&&e>t){y("Min price cannot be greater than max price");return}f(!0),y(null);try{console.log("[RefineSearch] Applying filters:",{priceMin:e,priceMax:t,brand:o.trim()||void 0});let r={priceMin:null!=e?e:null,priceMax:null!=t?t:null,brand:o.trim()||null};(0,C.j)("search_triggered",{qtype:"image",filters:r});let s=await N(n,i,{topK:5,minSimilarity:.55,priceMin:e,priceMax:t,brand:o.trim()||void 0});console.log("[RefineSearch] Got results:",s.length),l(s),a()}catch(e){var r;console.error("[RefineSearch] Error:",e),y((null==e?void 0:e.message)||(null==e?void 0:null===(r=e.error)||void 0===r?void 0:r.message)||"Refine search failed. Make sure the database migration has been applied.")}finally{f(!1)}}return(0,r.jsx)("div",{className:"fixed inset-0 z-50 bg-black/50 grid place-items-end",children:(0,r.jsxs)("div",{className:"w-full max-w-md bg-background p-4 rounded-t-2xl shadow-xl border",children:[(0,r.jsxs)("div",{className:"flex items-center justify-between mb-3",children:[(0,r.jsx)("h3",{className:"text-lg font-semibold",children:"Refine search"}),(0,r.jsx)("button",{onClick:a,className:"text-sm",children:"Close"})]}),(0,r.jsxs)("div",{className:"grid gap-3",children:[(0,r.jsxs)("label",{className:"grid gap-1",children:[(0,r.jsx)("span",{className:"text-sm opacity-60",children:"Brand (optional)"}),(0,r.jsxs)("select",{value:o,onChange:e=>c(e.target.value),className:"border rounded px-3 py-2 bg-background",disabled:v,children:[(0,r.jsx)("option",{value:"",children:"All brands"}),d.map(e=>(0,r.jsx)("option",{value:e,children:e},e))]}),v&&(0,r.jsx)("span",{className:"text-xs opacity-60",children:"Loading brands..."})]}),(0,r.jsxs)("div",{className:"grid grid-cols-2 gap-3",children:[(0,r.jsxs)("label",{className:"grid gap-1",children:[(0,r.jsx)("span",{className:"text-sm opacity-60",children:"Min price"}),(0,r.jsx)("input",{value:h,onChange:e=>m(e.target.value),placeholder:"e.g. 70",inputMode:"numeric",className:"border rounded px-3 py-2 bg-background"})]}),(0,r.jsxs)("label",{className:"grid gap-1",children:[(0,r.jsx)("span",{className:"text-sm opacity-60",children:"Max price"}),(0,r.jsx)("input",{value:g,onChange:e=>x(e.target.value),placeholder:"e.g. 300",inputMode:"numeric",className:"border rounded px-3 py-2 bg-background"})]})]}),w&&(0,r.jsx)("p",{className:"text-red-600 text-sm",children:w}),(0,r.jsx)("button",{onClick:k,disabled:p,className:"bg-foreground text-background rounded px-4 py-2 border",children:p?"Searching…":"Apply filters"})]})]})})}var T=a(9026),D=a(2369),A=a(8997),O=a(7692);function F(e){let{isOpen:t,onClose:a,initialMode:n="signin"}=e,[i,o]=(0,s.useState)(n),[c,d]=(0,s.useState)(""),[u,h]=(0,s.useState)(""),[m,g]=(0,s.useState)(""),[x,p]=(0,s.useState)(null),[f,b]=(0,s.useState)(!1),{signIn:v,signUp:j}=(0,T.a)();if(!t)return null;let w=async e=>{e.preventDefault(),p(null),b(!0);try{if("signin"===i){let{error:e}=await v(c,u);e?p(e.message||"Failed to sign in"):a()}else{let{error:e}=await j(c,u,m);e?p(e.message||"Failed to sign up"):p("Check your email to confirm your account!")}}catch(e){p(e.message||"An error occurred")}finally{b(!1)}};return(0,r.jsx)("div",{className:"fixed inset-0 z-50 bg-black/50 grid place-items-center p-4",children:(0,r.jsxs)("div",{className:"w-full max-w-md bg-background border rounded-lg p-6 relative",children:[(0,r.jsx)("button",{onClick:a,className:"absolute top-4 right-4 p-1 hover:bg-muted rounded","aria-label":"Close",children:(0,r.jsx)(l.Z,{className:"w-5 h-5"})}),(0,r.jsx)("h2",{className:"text-2xl font-bold mb-6",children:"signin"===i?"Sign In":"Sign Up"}),(0,r.jsxs)("form",{onSubmit:w,className:"space-y-4",children:["signup"===i&&(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{className:"block text-sm font-medium mb-1",children:"Display Name"}),(0,r.jsx)("input",{type:"text",value:m,onChange:e=>g(e.target.value),className:"w-full border rounded px-3 py-2 bg-background",placeholder:"Your name"})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{className:"block text-sm font-medium mb-1",children:"Email"}),(0,r.jsx)("input",{type:"email",value:c,onChange:e=>d(e.target.value),required:!0,className:"w-full border rounded px-3 py-2 bg-background",placeholder:"you@example.com"})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{className:"block text-sm font-medium mb-1",children:"Password"}),(0,r.jsx)("input",{type:"password",value:u,onChange:e=>h(e.target.value),required:!0,minLength:6,className:"w-full border rounded px-3 py-2 bg-background",placeholder:"••••••••"})]}),x&&(0,r.jsx)("div",{className:"text-red-600 text-sm",children:x}),(0,r.jsx)(I.z,{type:"submit",disabled:f,className:"w-full",children:f?"Please wait...":"signin"===i?"Sign In":"Sign Up"})]}),(0,r.jsx)("div",{className:"mt-4 text-center text-sm",children:"signin"===i?(0,r.jsxs)(r.Fragment,{children:["Don't have an account?"," ",(0,r.jsx)("button",{onClick:()=>{o("signup"),p(null)},className:"underline hover:no-underline",children:"Sign up"})]}):(0,r.jsxs)(r.Fragment,{children:["Already have an account?"," ",(0,r.jsx)("button",{onClick:()=>{o("signin"),p(null)},className:"underline hover:no-underline",children:"Sign in"})]})})]})})}var Z=a(6362);function U(){let{user:e}=(0,T.a)(),[t,a]=(0,s.useState)([]),[n,i]=(0,s.useState)(!0);(0,s.useEffect)(()=>{e&&l()},[e]);let l=async()=>{if(e){i(!0);try{let{data:t,error:r}=await k.O.rpc("get_user_closet",{p_user_id:e.id,p_limit:100,p_offset:0});r?console.error("Failed to load closet:",r):a(t||[])}catch(e){console.error("Error loading closet:",e)}finally{i(!1)}}},o=async t=>{if(e)try{let{error:a}=await k.O.rpc("toggle_closet_item",{p_user_id:e.id,p_product_id:t});a?console.error("Failed to remove item:",a):l()}catch(e){console.error("Error removing item:",e)}};return n?(0,r.jsx)("div",{className:"text-center py-8",children:"Loading your closet..."}):0===t.length?(0,r.jsxs)("div",{className:"text-center py-12",children:[(0,r.jsx)(A.Z,{className:"w-16 h-16 mx-auto mb-4 opacity-20"}),(0,r.jsx)("h3",{className:"text-lg font-semibold mb-2",children:"Your closet is empty"}),(0,r.jsx)("p",{className:"text-sm opacity-60",children:"Save items you like by clicking the heart icon on any product"})]}):(0,r.jsxs)("div",{children:[(0,r.jsxs)("h2",{className:"text-2xl font-bold mb-6",children:["My Closet (",t.length,")"]}),(0,r.jsx)("div",{className:"grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-4",children:t.map(e=>(0,r.jsxs)("div",{className:"group relative",children:[(0,r.jsxs)("div",{className:"aspect-[3/4] relative overflow-hidden bg-muted/20 mb-2 border",children:[e.main_image_url?(0,r.jsx)("img",{src:e.main_image_url,alt:e.title,className:"w-full h-full object-cover"}):(0,r.jsx)("div",{className:"w-full h-full flex items-center justify-center",children:(0,r.jsx)("span",{className:"text-xs opacity-40",children:"No image"})}),(0,r.jsx)("button",{onClick:()=>o(e.product_id),className:"absolute top-2 right-2 p-2 bg-background/80 hover:bg-background rounded-full","aria-label":"Remove from closet",children:(0,r.jsx)(A.Z,{className:"w-4 h-4 fill-red-600 text-red-600"})})]}),(0,r.jsxs)("div",{className:"space-y-1",children:[(0,r.jsx)("h3",{className:"text-xs font-medium line-clamp-2",title:e.title,children:e.title}),e.brand&&(0,r.jsx)("p",{className:"text-xs opacity-60",children:e.brand}),e.price&&(0,r.jsxs)("p",{className:"text-xs font-bold",children:["$",e.price.toFixed(2)]}),e.url&&(0,r.jsxs)("a",{href:e.url,target:"_blank",rel:"noopener noreferrer",className:"inline-flex items-center gap-1 text-xs underline hover:no-underline",children:["View Product ",(0,r.jsx)(Z.Z,{className:"w-3 h-3"})]})]})]},e.id))})]})}function B(){var e;let{user:t,signOut:a,loading:n}=(0,T.a)(),[i,o]=(0,s.useState)(!1),[c,d]=(0,s.useState)(!1),[u,h]=(0,s.useState)(!1);return n?(0,r.jsx)("div",{className:"fixed top-4 right-4 z-50",children:(0,r.jsx)("div",{className:"bg-background border px-4 py-2 rounded text-xs",children:"Loading..."})}):t?(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)("div",{className:"fixed top-4 right-4 z-50",children:(0,r.jsxs)("div",{className:"relative",children:[(0,r.jsxs)("button",{onClick:()=>h(!u),className:"bg-background border rounded-lg px-4 py-2 flex items-center gap-2 hover:bg-muted transition-colors",children:[(0,r.jsx)(D.Z,{className:"w-4 h-4"}),(0,r.jsx)("span",{className:"text-sm font-medium truncate max-w-[150px]",children:(null===(e=t.email)||void 0===e?void 0:e.split("@")[0])||"User"})]}),u&&(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)("div",{className:"fixed inset-0 z-40",onClick:()=>h(!1)}),(0,r.jsx)("div",{className:"absolute top-full right-0 mt-2 bg-background border rounded-lg shadow-lg z-50 min-w-[200px]",children:(0,r.jsxs)("div",{className:"p-1",children:[(0,r.jsxs)("button",{onClick:()=>{d(!0),h(!1)},className:"w-full flex items-center gap-2 px-3 py-2 text-sm hover:bg-muted rounded",children:[(0,r.jsx)(A.Z,{className:"w-4 h-4"}),"My Closet"]}),(0,r.jsxs)("button",{onClick:()=>{a(),h(!1)},className:"w-full flex items-center gap-2 px-3 py-2 text-sm hover:bg-muted rounded text-red-600",children:[(0,r.jsx)(O.Z,{className:"w-4 h-4"}),"Sign Out"]})]})})]})]})}),c&&(0,r.jsx)("div",{className:"fixed inset-0 z-50 bg-black/50 grid place-items-center p-4",children:(0,r.jsxs)("div",{className:"w-full max-w-4xl bg-background border rounded-lg p-6 relative max-h-[90vh] overflow-auto",children:[(0,r.jsx)("button",{onClick:()=>d(!1),className:"absolute top-4 right-4 p-1 hover:bg-muted rounded","aria-label":"Close",children:(0,r.jsx)(l.Z,{className:"w-5 h-5"})}),(0,r.jsx)(U,{})]})})]}):(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)("div",{className:"fixed top-4 right-4 z-50",children:(0,r.jsx)(I.z,{onClick:()=>o(!0),className:"text-xs tracking-wide uppercase",size:"sm",children:"Sign In"})}),(0,r.jsx)(F,{isOpen:i,onClose:()=>o(!1)})]})}function Y(e){let{productId:t,productTitle:a}=e,{user:n}=(0,T.a)(),[i,l]=(0,s.useState)(!1),[o,c]=(0,s.useState)(!1),{toast:d}=p();(0,s.useEffect)(()=>{n&&u()},[n,t]);let u=async()=>{if(n&&t)try{let{data:e,error:a}=await k.O.rpc("is_product_saved",{p_user_id:n.id,p_product_id:t});if(a){console.error("[SaveButton] Error checking saved status:",a);return}null!=e&&l(e)}catch(e){console.error("[SaveButton] Error checking saved status:",e)}},h=async e=>{if(e.stopPropagation(),!n){d({title:"Sign in required",description:"Please sign in to save items to your closet",variant:"destructive"});return}if(!t){console.error("[SaveButton] No product ID provided");return}c(!0);try{console.log("[SaveButton] Toggling save:",{userId:n.id,productId:t});let{data:e,error:r}=await k.O.rpc("toggle_closet_item",{p_user_id:n.id,p_product_id:t});console.log("[SaveButton] Toggle result:",{data:e,error:r}),r?(console.error("Failed to toggle save:",r),d({title:"Error",description:r.message||"Failed to save item. Make sure you're signed in.",variant:"destructive"})):(l((null==e?void 0:e.is_saved)||!1),(null==e?void 0:e.action)==="added"&&(0,C.j)("item_saved",{productId:t}),await _((null==e?void 0:e.action)==="added"?"product_saved":"product_unsaved",{product_id:t,product_title:a}),d({title:(null==e?void 0:e.action)==="added"?"Saved to closet":"Removed from closet",description:(null==e?void 0:e.action)==="added"?"Item added to your closet":"Item removed from your closet"}))}catch(e){console.error("Error toggling save:",e),d({title:"Error",description:"An error occurred",variant:"destructive"})}finally{c(!1)}};return(0,r.jsx)("button",{onClick:h,disabled:o,className:"p-2 rounded-full transition-colors ".concat(i?"bg-red-50 text-red-600 hover:bg-red-100":"bg-background border hover:bg-muted"),"aria-label":i?"Remove from closet":"Save to closet",title:i?"Remove from closet":"Save to closet",children:(0,r.jsx)(A.Z,{className:"w-4 h-4 ".concat(i?"fill-current":"")})})}var V=a(5994),L=a(2835);let J=V.fC,X=V.xz,q=V.h_;V.x8;let H=s.forwardRef((e,t)=>{let{className:a,...s}=e;return(0,r.jsx)(V.aV,{ref:t,className:(0,L.cn)("fixed inset-0 z-50 bg-black/80  data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0",a),...s})});H.displayName=V.aV.displayName;let G=s.forwardRef((e,t)=>{let{className:a,children:s,...n}=e;return(0,r.jsxs)(q,{children:[(0,r.jsx)(H,{}),(0,r.jsxs)(V.VY,{ref:t,className:(0,L.cn)("fixed left-[50%] top-[50%] z-50 grid w-full max-w-lg translate-x-[-50%] translate-y-[-50%] gap-4 border bg-background p-6 shadow-lg duration-200 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[state=closed]:slide-out-to-left-1/2 data-[state=closed]:slide-out-to-top-[48%] data-[state=open]:slide-in-from-left-1/2 data-[state=open]:slide-in-from-top-[48%] sm:rounded-lg",a),...n,children:[s,(0,r.jsxs)(V.x8,{className:"absolute right-4 top-4 rounded-sm opacity-70 ring-offset-background transition-opacity hover:opacity-100 focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:pointer-events-none data-[state=open]:bg-accent data-[state=open]:text-muted-foreground",children:[(0,r.jsx)(l.Z,{className:"h-4 w-4"}),(0,r.jsx)("span",{className:"sr-only",children:"Close"})]})]})]})});function W(e){let{src:t,alt:a="Search image"}=e,[n,i]=(0,s.useState)(!1);return(0,r.jsxs)(J,{open:n,onOpenChange:i,children:[(0,r.jsx)(X,{asChild:!0,children:(0,r.jsx)("button",{"aria-label":"Enlarge search image",className:"cursor-pointer hover:opacity-80 transition-opacity w-full h-full",children:(0,r.jsx)("img",{src:t,alt:a,className:"w-full h-full object-cover rounded-md"})})}),(0,r.jsx)(G,{className:"max-w-3xl",children:(0,r.jsx)("div",{className:"relative w-full h-[70vh]",children:(0,r.jsx)("img",{src:t,alt:a,className:"w-full h-full object-contain"})})})]})}G.displayName=V.VY.displayName,s.forwardRef((e,t)=>{let{className:a,...s}=e;return(0,r.jsx)(V.Dx,{ref:t,className:(0,L.cn)("text-lg font-semibold leading-none tracking-tight",a),...s})}).displayName=V.Dx.displayName,s.forwardRef((e,t)=>{let{className:a,...s}=e;return(0,r.jsx)(V.dk,{ref:t,className:(0,L.cn)("text-sm text-muted-foreground",a),...s})}).displayName=V.dk.displayName;var K=a(9467),Q=a(3982),$=a(2451),ee=a(407);function et(e){let{products:t,onProductClick:a}=e,[n,i]=(0,s.useState)(0),[l,o]=(0,K.Z)({loop:!0,align:"center",skipSnaps:!1,dragFree:!1},[]),c=(0,s.useCallback)(e=>o&&o.scrollTo(e),[o]),d=(0,s.useCallback)(()=>{o&&o.scrollPrev()},[o]),u=(0,s.useCallback)(()=>{o&&o.scrollNext()},[o]);if((0,s.useEffect)(()=>{if(!o)return;let e=()=>{i(o.selectedScrollSnap())};return o.on("select",e),e(),()=>{o.off("select",e)}},[o]),(0,s.useEffect)(()=>{let e=e=>{"ArrowLeft"===e.key?d():"ArrowRight"===e.key&&u()};return window.addEventListener("keydown",e),()=>window.removeEventListener("keydown",e)},[d,u]),0===t.length)return null;let h=e=>{let a=t.length,r=(e-n+a)%a;return 0===r?{zIndex:3,scale:1,x:0,y:0,rotateY:0,opacity:1,filter:"blur(0px)"}:r===a-1?{zIndex:2,scale:.9,x:-14,y:0,rotateY:18,opacity:.85,filter:"blur(0.5px)"}:1===r?{zIndex:2,scale:.9,x:14,y:0,rotateY:-18,opacity:.85,filter:"blur(0.5px)"}:{zIndex:1,scale:.8,x:r<a/2?-20:20,y:0,rotateY:r<a/2?25:-25,opacity:.55,filter:"blur(1px)"}};return(0,r.jsxs)("div",{className:"relative w-full",style:{perspective:"1200px"},children:[(0,r.jsx)("div",{className:"relative overflow-hidden",ref:l,children:(0,r.jsx)("div",{className:"flex",style:{backfaceVisibility:"hidden"},children:t.map((e,t)=>{let s=h(t),i=t===n;return(0,r.jsx)("div",{className:"flex-[0_0_100%] min-w-0 px-4",onClick:()=>!i&&c(t),style:{cursor:i?"default":"pointer"},children:(0,r.jsx)(Q.E.div,{className:"relative aspect-[3/4] bg-muted/20 rounded-lg overflow-hidden border border-border",style:{transformStyle:"preserve-3d",willChange:"transform"},animate:{scale:s.scale,x:"".concat(s.x,"%"),y:s.y,rotateY:s.rotateY,opacity:s.opacity,filter:s.filter,zIndex:s.zIndex},transition:{duration:.3,ease:"easeOut"},children:(0,r.jsxs)("div",{className:"absolute inset-0",children:[(0,r.jsx)("img",{src:e.main_image_url||"/placeholder.jpg",alt:e.title,className:"w-full h-full object-cover"}),(0,r.jsx)("div",{className:"absolute inset-0 bg-gradient-to-t from-background/80 via-background/0 to-background/0"}),(0,r.jsx)("div",{className:"absolute top-4 right-4 z-10",children:(0,r.jsx)(Y,{productId:e.id,productTitle:e.title})}),i&&(0,r.jsxs)(Q.E.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},className:"absolute bottom-0 left-0 right-0 p-6 bg-background/95 backdrop-blur-sm",style:{pointerEvents:"none",zIndex:20},children:[(0,r.jsx)("h3",{className:"text-lg font-bold mb-2 line-clamp-2",title:e.title,children:e.title}),(0,r.jsxs)("div",{className:"flex items-center justify-between",children:[(0,r.jsxs)("div",{style:{pointerEvents:"none"},children:[e.brand&&(0,r.jsx)("p",{className:"text-sm opacity-60 mb-1",children:e.brand}),(0,r.jsx)("p",{className:"text-xl font-bold",children:e.price?"$".concat(e.price.toFixed(2)):"Price N/A"})]}),e.url?(0,r.jsx)("a",{href:e.url,target:"_blank",rel:"noopener noreferrer",onClick:t=>{t.stopPropagation(),a(e)},className:"px-6 py-2 text-sm bg-foreground text-background hover:bg-foreground/80 transition-colors rounded-md inline-flex items-center justify-center",style:{pointerEvents:"auto",zIndex:30},children:"View Product"}):(0,r.jsx)("button",{onClick:t=>{t.stopPropagation(),a(e)},className:"px-6 py-2 text-sm bg-foreground text-background hover:bg-foreground/80 transition-colors rounded-md",style:{pointerEvents:"auto",zIndex:30},children:"View Product"})]})]})]})})},e.id)})})}),t.length>1&&(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)("button",{onClick:d,className:"absolute left-4 top-1/2 -translate-y-1/2 z-20 p-2 bg-background/80 hover:bg-background rounded-full border border-border transition-colors","aria-label":"Previous product",children:(0,r.jsx)($.Z,{className:"w-6 h-6"})}),(0,r.jsx)("button",{onClick:u,className:"absolute right-4 top-1/2 -translate-y-1/2 z-20 p-2 bg-background/80 hover:bg-background rounded-full border border-border transition-colors","aria-label":"Next product",children:(0,r.jsx)(ee.Z,{className:"w-6 h-6"})})]}),t.length>1&&(0,r.jsx)("div",{className:"flex justify-center gap-2 mt-6",children:t.map((e,t)=>(0,r.jsx)("button",{onClick:()=>c(t),className:"w-2 h-2 rounded-full transition-all ".concat(t===n?"bg-foreground w-8":"bg-border hover:bg-foreground/50"),"aria-label":"Go to product ".concat(t+1)},t))}),(0,r.jsxs)("div",{className:"text-center mt-4 text-xs opacity-60",children:[n+1," / ",t.length]})]})}var ea=a(1906),er=a(7689),es=a(2883),en=a(3247);let ei=s.forwardRef((e,t)=>{let{className:a,...s}=e;return(0,r.jsx)("div",{ref:t,className:(0,L.cn)("rounded-lg border bg-card text-card-foreground shadow-sm",a),...s})});ei.displayName="Card";let el=s.forwardRef((e,t)=>{let{className:a,...s}=e;return(0,r.jsx)("div",{ref:t,className:(0,L.cn)("flex flex-col space-y-1.5 p-6",a),...s})});el.displayName="CardHeader";let eo=s.forwardRef((e,t)=>{let{className:a,...s}=e;return(0,r.jsx)("h3",{ref:t,className:(0,L.cn)("text-2xl font-semibold leading-none tracking-tight",a),...s})});eo.displayName="CardTitle",s.forwardRef((e,t)=>{let{className:a,...s}=e;return(0,r.jsx)("p",{ref:t,className:(0,L.cn)("text-sm text-muted-foreground",a),...s})}).displayName="CardDescription";let ec=s.forwardRef((e,t)=>{let{className:a,...s}=e;return(0,r.jsx)("div",{ref:t,className:(0,L.cn)("p-6 pt-0",a),...s})});ec.displayName="CardContent",s.forwardRef((e,t)=>{let{className:a,...s}=e;return(0,r.jsx)("div",{ref:t,className:(0,L.cn)("flex items-center p-6 pt-0",a),...s})}).displayName="CardFooter";let ed=s.forwardRef((e,t)=>{let{className:a,type:s,...n}=e;return(0,r.jsx)("input",{type:s,className:(0,L.cn)("flex h-10 w-full rounded-md border border-input bg-background px-3 py-2 text-base ring-offset-background file:border-0 file:bg-transparent file:text-sm file:font-medium file:text-foreground placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 md:text-sm",a),ref:t,...n})});ed.displayName="Input";var eu=a(535);let eh=V.fC,em=V.xz;V.x8;let eg=V.h_,ex=s.forwardRef((e,t)=>{let{className:a,...s}=e;return(0,r.jsx)(V.aV,{className:(0,L.cn)("fixed inset-0 z-50 bg-black/80  data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0",a),...s,ref:t})});ex.displayName=V.aV.displayName;let ep=(0,eu.j)("fixed z-50 gap-4 bg-background p-6 shadow-lg transition ease-in-out data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:duration-300 data-[state=open]:duration-500",{variants:{side:{top:"inset-x-0 top-0 border-b data-[state=closed]:slide-out-to-top data-[state=open]:slide-in-from-top",bottom:"inset-x-0 bottom-0 border-t data-[state=closed]:slide-out-to-bottom data-[state=open]:slide-in-from-bottom",left:"inset-y-0 left-0 h-full w-3/4 border-r data-[state=closed]:slide-out-to-left data-[state=open]:slide-in-from-left sm:max-w-sm",right:"inset-y-0 right-0 h-full w-3/4  border-l data-[state=closed]:slide-out-to-right data-[state=open]:slide-in-from-right sm:max-w-sm"}},defaultVariants:{side:"right"}}),ef=s.forwardRef((e,t)=>{let{side:a="right",className:s,children:n,...i}=e;return(0,r.jsxs)(eg,{children:[(0,r.jsx)(ex,{}),(0,r.jsxs)(V.VY,{ref:t,className:(0,L.cn)(ep({side:a}),s),...i,children:[n,(0,r.jsxs)(V.x8,{className:"absolute right-4 top-4 rounded-sm opacity-70 ring-offset-background transition-opacity hover:opacity-100 focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:pointer-events-none data-[state=open]:bg-secondary",children:[(0,r.jsx)(l.Z,{className:"h-4 w-4"}),(0,r.jsx)("span",{className:"sr-only",children:"Close"})]})]})]})});ef.displayName=V.VY.displayName;let eb=e=>{let{className:t,...a}=e;return(0,r.jsx)("div",{className:(0,L.cn)("flex flex-col space-y-2 text-center sm:text-left",t),...a})};eb.displayName="SheetHeader";let ev=s.forwardRef((e,t)=>{let{className:a,...s}=e;return(0,r.jsx)(V.Dx,{ref:t,className:(0,L.cn)("text-lg font-semibold text-foreground",a),...s})});ev.displayName=V.Dx.displayName,s.forwardRef((e,t)=>{let{className:a,...s}=e;return(0,r.jsx)(V.dk,{ref:t,className:(0,L.cn)("text-sm text-muted-foreground",a),...s})}).displayName=V.dk.displayName;var ej=a(6394);let ew=(0,eu.j)("text-sm font-medium leading-none peer-disabled:cursor-not-allowed peer-disabled:opacity-70"),ey=s.forwardRef((e,t)=>{let{className:a,...s}=e;return(0,r.jsx)(ej.f,{ref:t,className:(0,L.cn)(ew(),a),...s})});ey.displayName=ej.f.displayName;var eN=a(1886);let ek=s.forwardRef((e,t)=>{let{className:a,...s}=e;return(0,r.jsxs)(eN.fC,{ref:t,className:(0,L.cn)("relative flex w-full touch-none select-none items-center",a),...s,children:[(0,r.jsx)(eN.fQ,{className:"relative h-2 w-full grow overflow-hidden rounded-full bg-secondary",children:(0,r.jsx)(eN.e6,{className:"absolute h-full bg-primary"})}),(0,r.jsx)(eN.bU,{className:"block h-5 w-5 rounded-full border-2 border-primary bg-background ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50"})]})});ek.displayName=eN.fC.displayName;let eS=null;try{eS=a(7860).s}catch(e){}function e_(e){let{initialItems:t,initialUserImage:a,onRefineConfirm:i,onNewSearch:l,showHeader:o=!0}=e,[c]=(0,s.useState)(t),[d,u]=(0,s.useState)(0),[h,m]=(0,s.useState)(null!=a?a:null),[g,x]=(0,s.useState)(!1),[p,f]=(0,s.useState)({x:80,y:80,w:240,h:240}),[b,v]=(0,s.useState)(50),[j,w]=(0,s.useState)(50),[y,N]=(0,s.useState)(50),k=e=>{let t=new FileReader;t.onload=e=>{var t;return m(String((null===(t=e.target)||void 0===t?void 0:t.result)||null))},t.readAsDataURL(e)};return 0===t.length?(0,r.jsx)("div",{className:"min-h-screen flex items-center justify-center bg-white",children:(0,r.jsxs)("div",{className:"text-center space-y-4",children:[(0,r.jsx)("p",{className:"text-lg text-neutral-500",children:"No results found"}),l&&(0,r.jsx)(I.z,{onClick:l,variant:"outline",children:"Start New Search"})]})}):(0,r.jsxs)("div",{className:"min-h-screen w-full bg-white text-neutral-900",children:[o&&(0,r.jsx)(eI,{}),(0,r.jsxs)("main",{className:"mx-auto grid max-w-[120rem] grid-cols-12 gap-6 px-4 pb-24 pt-6 lg:px-8",children:[(0,r.jsx)("aside",{className:"col-span-12 md:col-span-3 xl:col-span-2",children:(0,r.jsxs)(ei,{className:"sticky top-4 border-neutral-200 shadow-sm",children:[(0,r.jsx)(el,{className:"pb-2",children:(0,r.jsx)(eo,{className:"text-base font-semibold",children:"Your image"})}),(0,r.jsxs)(ec,{className:"space-y-4",children:[(0,r.jsx)("div",{className:"relative aspect-square overflow-hidden rounded-xl border bg-neutral-50",children:h?(0,r.jsx)(n.default,{src:h,alt:"Uploaded",fill:!0,className:"object-cover"}):(0,r.jsx)("div",{className:"grid h-full place-content-center text-sm text-neutral-500",children:"No image"})}),(0,r.jsxs)("label",{className:"inline-flex cursor-pointer items-center gap-2 rounded-xl border px-3 py-2 text-sm hover:bg-neutral-50",children:[(0,r.jsx)(er.Z,{className:"h-4 w-4"}),(0,r.jsx)("span",{children:"Upload new"}),(0,r.jsx)("input",{type:"file",accept:"image/*",className:"hidden",onChange:e=>{var t;let a=null===(t=e.target.files)||void 0===t?void 0:t[0];a&&k(a)}})]}),(0,r.jsxs)(eh,{open:g,onOpenChange:x,children:[(0,r.jsx)(em,{asChild:!0,children:(0,r.jsxs)(I.z,{className:"w-full gap-2",children:[(0,r.jsx)(es.Z,{className:"h-4 w-4"})," Refine search"]})}),(0,r.jsxs)(ef,{side:"right",className:"w-full sm:max-w-xl",children:[(0,r.jsx)(eb,{children:(0,r.jsx)(ev,{children:"Refine search"})}),(0,r.jsxs)("div",{className:"mt-4 space-y-6",children:[(0,r.jsxs)("div",{className:"space-y-2",children:[(0,r.jsx)(ey,{className:"text-sm",children:"Crop focus"}),(0,r.jsx)("div",{className:"relative aspect-[4/5] overflow-hidden rounded-xl border bg-neutral-50",children:h&&(0,r.jsxs)("div",{className:"absolute inset-0",children:[(0,r.jsx)(n.default,{src:h,alt:"crop",fill:!0,className:"object-cover"}),eS?(0,r.jsx)(eS,{bounds:"parent",default:{x:p.x,y:p.y,width:p.w,height:p.h},onDragStop:(e,t)=>f(e=>({...e,x:t.x,y:t.y})),onResizeStop:(e,t,a,r,s)=>f({x:s.x,y:s.y,w:a.offsetWidth,h:a.offsetHeight}),style:{border:"2px solid white",boxShadow:"0 0 0 9999px rgba(0,0,0,.35) inset"},className:"rounded-lg"}):(0,r.jsxs)("div",{className:"absolute inset-0 grid place-content-center text-xs text-white/80",children:["Install ",(0,r.jsx)("code",{children:"react-rnd"})," to enable drag/resize"]})]})})]}),(0,r.jsx)(ez,{label:"Color weight",value:b,onChange:v}),(0,r.jsx)(ez,{label:"Texture weight",value:j,onChange:w}),(0,r.jsx)(ez,{label:"Silhouette weight",value:y,onChange:N}),(0,r.jsxs)("div",{className:"flex gap-3 pt-2",children:[(0,r.jsx)(I.z,{className:"flex-1",onClick:()=>{i&&i({crop:p,weights:{color:b,texture:j,silhouette:y},userImage:h||void 0}),x(!1)},children:"Apply"}),(0,r.jsx)(I.z,{variant:"outline",className:"flex-1",onClick:()=>x(!1),children:"Cancel"})]})]})]})]}),l&&(0,r.jsx)(I.z,{variant:"outline",className:"w-full",onClick:l,children:"New Search"})]})]})}),(0,r.jsx)("section",{className:"col-span-12 md:col-span-9 xl:col-span-10",children:(0,r.jsx)(eC,{items:c,active:d,setActive:u,getImageUrl:e=>e.main_image_url||e.image||"/placeholder.jpg"})})]})]})}function eC(e){let{items:t,active:a,setActive:i,getImageUrl:l}=e,o=(0,ea.c)(-(24*a));(0,s.useEffect)(()=>{o.stop(),o.set(-(24*a))},[a,o,24]);let c=(e,t)=>(e%t+t)%t;return(0,r.jsxs)("div",{className:"relative mx-auto w-full max-w-[1400px]",children:[(0,r.jsxs)("div",{className:"mb-4 flex items-center justify-center gap-2",children:[(0,r.jsx)(I.z,{size:"icon",variant:"ghost",className:"h-10 w-10 rounded-full border",onClick:()=>i(c(a-1,t.length)),children:(0,r.jsx)($.Z,{className:"h-5 w-5"})}),(0,r.jsxs)("div",{className:"text-xs text-neutral-500 tabular-nums",children:[a+1," / ",t.length]}),(0,r.jsx)(I.z,{size:"icon",variant:"ghost",className:"h-10 w-10 rounded-full border",onClick:()=>i(c(a+1,t.length)),children:(0,r.jsx)(ee.Z,{className:"h-5 w-5"})})]}),(0,r.jsxs)("div",{className:"relative h-[74vh] min-h-[560px] w-full overflow-visible",style:{perspective:2e3},children:[(0,r.jsx)(Q.E.div,{className:"absolute left-1/2 top-1/2 h-full w-full -translate-x-1/2 -translate-y-1/2 [transform-style:preserve-3d]",style:{rotateY:o},children:t.map((e,t)=>(0,r.jsx)("div",{className:"absolute left-1/2 top-1/2 -translate-x-1/2 -translate-y-1/2 overflow-visible [transform-style:preserve-3d] will-change-transform",style:{width:"clamp(240px, 36vw, 380px)",height:"clamp(360px, 56vh, 560px)",transform:"rotateY(".concat(24*t,"deg) translateZ(").concat(560,"px)")},children:(0,r.jsxs)(ei,{className:"h-full overflow-hidden rounded-2xl border border-neutral-200 bg-white shadow-2xl",children:[(0,r.jsxs)("div",{className:"relative h-[82%] w-full overflow-hidden",children:[(0,r.jsx)(n.default,{src:l(e),alt:e.title,fill:!0,className:"object-cover"}),(0,r.jsx)("div",{className:"absolute right-3 top-3 z-10",children:(0,r.jsx)(Y,{productId:e.id,productTitle:e.title})})]}),(0,r.jsxs)("div",{className:"relative h-[10%] w-full -translate-y-1",children:[(0,r.jsx)("div",{className:"relative h-full w-full",style:{transform:"scaleY(-1)",opacity:.25},children:(0,r.jsx)(n.default,{src:l(e),alt:"reflection",fill:!0,className:"object-cover"})}),(0,r.jsx)("div",{className:"pointer-events-none absolute inset-0",style:{background:"linear-gradient(to bottom, rgba(255,255,255,0.2), rgba(255,255,255,1))"}})]}),(0,r.jsxs)(ec,{className:"flex h-[8%] items-center justify-between gap-3 p-3",children:[(0,r.jsxs)("div",{className:"min-w-0 flex-1",children:[e.brand&&(0,r.jsx)("div",{className:"truncate text-xs text-neutral-500",children:e.brand}),(0,r.jsx)("div",{className:"truncate text-sm font-semibold",children:e.title}),void 0!==e.price&&(0,r.jsxs)("div",{className:"text-xs font-semibold text-neutral-700 mt-1",children:["$",e.price.toFixed(2)]})]}),e.url?(0,r.jsx)("a",{href:e.url,target:"_blank",rel:"noopener noreferrer",onClick:e=>e.stopPropagation(),children:(0,r.jsxs)(I.z,{size:"sm",className:"gap-1",children:["View ",(0,r.jsx)(Z.Z,{className:"h-3 w-3"})]})}):(0,r.jsxs)(I.z,{size:"sm",className:"gap-1",disabled:!0,children:["View ",(0,r.jsx)(Z.Z,{className:"h-3 w-3"})]})]})]})},e.id))}),(0,r.jsx)(Q.E.div,{className:"absolute inset-0 z-40 cursor-grab touch-none active:cursor-grabbing",drag:"x",dragConstraints:{left:0,right:0},dragElastic:.12,onDrag:(e,t)=>o.set(-(24*a)+.15*t.offset.x),onDragEnd:(e,a)=>{let r=.15*a.offset.x,s=c(Math.round(-(o.get()+r)/24),t.length);i(s),o.set(-(24*s))}})]}),(0,r.jsx)("div",{className:"mt-4 flex items-center justify-center gap-2",children:t.map((e,t)=>(0,r.jsx)("button",{onClick:()=>i(t),className:(0,L.cn)("h-1.5 w-1.5 rounded-full bg-neutral-300 transition-all",t===a?"w-6 bg-neutral-900":"w-1.5"),"aria-label":"Go to ".concat(t+1)},t))})]})}function eI(){return(0,r.jsx)("header",{className:"sticky top-0 z-40 w-full border-b bg-white/80 backdrop-blur",children:(0,r.jsxs)("div",{className:"mx-auto flex max-w-[120rem] items-center justify-between gap-3 px-4 py-3 lg:px-8",children:[(0,r.jsxs)("div",{className:"flex items-center gap-3",children:[(0,r.jsx)("div",{className:"grid h-9 w-9 place-content-center rounded-xl border bg-neutral-50 text-sm font-bold",children:"S"}),(0,r.jsx)("span",{className:"hidden text-lg font-semibold sm:inline",children:"SwagAI"})]}),(0,r.jsx)("div",{className:"hidden flex-1 items-center gap-2 md:flex",children:(0,r.jsxs)("div",{className:"relative w-full max-w-2xl",children:[(0,r.jsx)(en.Z,{className:"absolute left-3 top-1/2 h-4 w-4 -translate-y-1/2 text-neutral-400"}),(0,r.jsx)(ed,{placeholder:"Search brands, colors, items…",className:"pl-9"})]})}),(0,r.jsx)("div",{className:"flex items-center gap-2",children:(0,r.jsx)(B,{})})]})})}function ez(e){let{label:t,value:a,onChange:s}=e;return(0,r.jsxs)("div",{className:"space-y-2",children:[(0,r.jsxs)("div",{className:"flex items-center justify-between",children:[(0,r.jsx)(ey,{className:"text-sm",children:t}),(0,r.jsxs)("span",{className:"text-xs tabular-nums text-neutral-500",children:[a,"%"]})]}),(0,r.jsx)(ek,{value:[a],onValueChange:e=>s(e[0]),min:0,max:100,step:1})]})}function eE(){let[e,t]=(0,s.useState)(!1),[a,o]=(0,s.useState)([]),[c,d]=(0,s.useState)(!1),[u,h]=(0,s.useState)(null),[m,g]=(0,s.useState)(!1),[x,f]=(0,s.useState)(null),[b,v]=(0,s.useState)(null),[w,N]=(0,s.useState)(null),[k,S]=(0,s.useState)(!1),[I,z]=(0,s.useState)("results"),E=(0,s.useRef)(null),M=(0,s.useRef)(null),{toast:T}=p(),D=async e=>{t(!0),d(!1),h(URL.createObjectURL(e));try{console.log("Starting image search…"),(0,C.j)("search_triggered",{qtype:"image",filters:null});let{embedding:t,model:r}=await j(e);v(t),N(r);let s=(await y(t,r,{topK:5,minSimilarity:.55})).map(e=>{var t;return{...e,title:e.title||"Untitled",score:null!==(t=e.similarity)&&void 0!==t?t:void 0!==e.cos_distance?1-e.cos_distance:.5}});o(s),d(!0);try{var a;await _("image_search",{results_count:s.length,top_score:(null===(a=s[0])||void 0===a?void 0:a.score)||null,request_id:"req_".concat(Date.now(),"_").concat(Math.random().toString(36).substr(2,9))})}catch(e){console.warn("Analytics tracking failed:",e)}0===s.length?T({title:"No results found",description:"Try uploading a different image or adjusting your search.",variant:"destructive"}):T({title:"Search completed",description:"Found ".concat(s.length," similar products")})}catch(e){console.error("[UI] search error",e),(0,C.j)("search_failed",{reason:e instanceof Error?e.message:"unknown"}),T({title:"Search service unavailable",description:"The search service is warming up—please try again in a few seconds.",variant:"destructive"})}finally{t(!1)}},A=e=>{var t;let a=null===(t=e.target.files)||void 0===t?void 0:t[0];if(a){f(a),h(URL.createObjectURL(a)),g(!0);let t="camera-input"===e.target.id?"camera":"file";(0,C.j)("image_uploaded",{source:t})}},O=async e=>{(0,C.j)("result_clicked",{productId:e.id,brand:e.brand,price:e.price}),await _("product_click",{product_id:e.id,product_title:e.title,product_price:e.price,similarity_score:e.score}),e.url?((0,C.j)("affiliate_click",{productId:e.id,merchant:e.brand||"unknown",url:e.url}),window.open(e.url,"_blank","noopener,noreferrer")):T({title:"Product URL not available",description:e.title,variant:"destructive"})};return(0,r.jsxs)("div",{className:"min-h-screen bg-background relative overflow-hidden",children:[(0,r.jsx)("div",{className:"fixed inset-0 pointer-events-none",children:(0,r.jsx)("div",{className:"absolute inset-0 bg-gradient-to-br from-background via-background to-muted/20"})}),(0,r.jsx)("header",{className:"fixed top-0 left-0 z-50 p-4",children:(0,r.jsxs)("div",{className:"flex items-center gap-3 bg-background/95 backdrop-blur-sm px-4 py-2 border border-border/30",children:[(0,r.jsx)(n.default,{src:"/icons/lens.svg",alt:"",width:16,height:16,className:"h-4 w-auto"}),(0,r.jsx)("div",{className:"h-3 w-px bg-border"}),(0,r.jsx)(n.default,{src:"/logo.svg",alt:"Swagai",width:64,height:16,className:"h-4 w-auto"})]})}),(0,r.jsx)(B,{}),(0,r.jsxs)("div",{className:"relative z-10",children:[m&&x&&u&&(0,r.jsx)(R,{imageFile:x,imageUrl:u,onCropComplete:e=>{g(!1),D(e)},onCancel:()=>{g(!1),h(null),f(null),E.current&&(E.current.value=""),M.current&&(M.current.value="")}}),!m&&!e&&(0,r.jsxs)(r.Fragment,{children:[c&&a.length>0&&(0,r.jsx)("div",{className:"fixed bottom-6 right-6 z-40",children:(0,r.jsx)("button",{onClick:()=>S(!0),className:"px-4 py-2 border bg-background hover:bg-foreground hover:text-background transition-colors",children:"Refine search"})}),!c&&(0,r.jsx)("div",{className:"min-h-screen flex items-center px-6 md:px-16 lg:px-24",children:(0,r.jsxs)("div",{className:"w-full max-w-7xl mx-auto",children:[(0,r.jsxs)("div",{className:"grid lg:grid-cols-2 gap-20 items-center",children:[(0,r.jsxs)("div",{className:"space-y-10 lg:pt-0 pt-20",children:[(0,r.jsxs)("div",{className:"space-y-6",children:[(0,r.jsx)("div",{className:"inline-block px-3 py-1 border border-border/50",children:(0,r.jsx)("span",{className:"text-[9px] tracking-[0.25em] uppercase opacity-60",children:"Beta v1.0"})}),(0,r.jsxs)("h1",{className:"text-[clamp(3rem,10vw,7rem)] font-bold leading-[0.85] tracking-tighter",children:["MATCH",(0,r.jsx)("br",{}),"YOUR",(0,r.jsx)("br",{}),(0,r.jsx)("span",{className:"italic font-light",children:"Vision"})]}),(0,r.jsx)("p",{className:"text-sm leading-relaxed max-w-md opacity-70",children:"Upload any fashion image and our AI will find visually similar products from curated collections"})]}),(0,r.jsxs)("div",{className:"space-y-4",children:[(0,r.jsx)("label",{htmlFor:"file-input",className:"inline-flex items-center justify-center gap-2 whitespace-nowrap font-medium ring-offset-background focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring disabled:pointer-events-none disabled:opacity-50 [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0 transition-colors py-2 h-14 px-10 text-xs tracking-[0.2em] uppercase bg-foreground text-background hover:bg-foreground/90 border-2 border-foreground cursor-pointer",children:"Browse Files"}),(0,r.jsxs)("div",{className:"flex items-center gap-3",children:[(0,r.jsx)("div",{className:"h-px w-12 bg-border/50"}),(0,r.jsx)("label",{htmlFor:"camera-input",className:"text-xs tracking-wide opacity-60 hover:opacity-100 transition-opacity cursor-pointer",children:"or capture photo"})]})]})]}),(0,r.jsxs)("div",{className:"hidden lg:block relative",children:[(0,r.jsxs)("div",{className:"aspect-square relative",children:[(0,r.jsx)("div",{className:"absolute inset-0 border-2 border-border/30 translate-x-4 translate-y-4"}),(0,r.jsx)("div",{className:"absolute inset-0 border-2 border-foreground flex items-center justify-center bg-background",children:(0,r.jsx)(n.default,{src:"/icons/lens.svg",alt:"",width:128,height:128,className:"w-32 h-32 opacity-40"})})]}),(0,r.jsx)("div",{className:"absolute -bottom-6 -right-6 px-4 py-2 bg-foreground text-background text-[10px] tracking-[0.2em]",children:"AI POWERED"})]})]}),(0,r.jsx)("input",{id:"file-input",ref:E,type:"file",accept:"image/*",onChange:A,className:"hidden","aria-label":"Upload image file"}),(0,r.jsx)("input",{id:"camera-input",ref:M,type:"file",accept:"image/*",capture:"environment",onChange:A,className:"hidden","aria-label":"Capture photo"})]})}),e&&(0,r.jsx)("div",{className:"min-h-screen flex items-center justify-center px-6",children:(0,r.jsxs)("div",{className:"flex flex-col items-center gap-10",children:[(0,r.jsx)("div",{className:"relative",children:(0,r.jsx)(n.default,{src:"/icons/lens.svg",alt:"",width:96,height:96,className:"w-24 h-24 lens-blink"})}),(0,r.jsxs)("div",{className:"text-center space-y-2",children:[(0,r.jsx)("p",{className:"text-xs tracking-[0.3em] uppercase font-medium",children:"Processing Image"}),(0,r.jsxs)("div",{className:"flex gap-1 justify-center",children:[(0,r.jsx)("div",{className:"w-1 h-1 bg-foreground animate-pulse",style:{animationDelay:"0s"}}),(0,r.jsx)("div",{className:"w-1 h-1 bg-foreground animate-pulse",style:{animationDelay:"0.2s"}}),(0,r.jsx)("div",{className:"w-1 h-1 bg-foreground animate-pulse",style:{animationDelay:"0.4s"}})]})]})]})}),c&&!e&&(0,r.jsx)("div",{className:"min-h-screen px-6 md:px-16 lg:px-24 py-24",children:0===a.length?(0,r.jsxs)("div",{className:"min-h-[60vh] flex flex-col items-center justify-center space-y-6",children:[(0,r.jsx)("div",{className:"w-16 h-16 border-2 border-border flex items-center justify-center",children:(0,r.jsx)(i.Z,{className:"w-7 h-7"})}),(0,r.jsxs)("div",{className:"text-center space-y-3",children:[(0,r.jsx)("h3",{className:"text-base tracking-wide uppercase font-medium",children:"No Matches Found"}),(0,r.jsx)("button",{onClick:()=>{d(!1),o([]),h(null)},className:"text-xs tracking-wide underline underline-offset-4 hover:no-underline transition-all",children:"Try Different Image"})]})]}):(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)("div",{className:"mb-12 pb-6 border-b border-border/50",children:(0,r.jsxs)("div",{className:"flex items-center justify-between flex-wrap gap-4",children:[(0,r.jsxs)("div",{children:[(0,r.jsx)("h2",{className:"text-2xl font-bold tracking-tight mb-1",children:"Results"}),(0,r.jsxs)("p",{className:"text-xs opacity-60",children:[a.length," similar items found"]})]}),(0,r.jsxs)("div",{className:"flex gap-2 flex-wrap",children:[(0,r.jsxs)("div",{className:"flex border rounded-md overflow-hidden",children:[(0,r.jsx)("button",{onClick:()=>z("results"),className:"px-3 py-2 text-xs tracking-wide uppercase transition-colors ".concat("results"===I?"bg-foreground text-background":"bg-background hover:bg-foreground/10"),children:"Results"}),(0,r.jsx)("button",{onClick:()=>z("carousel"),className:"px-3 py-2 text-xs tracking-wide uppercase transition-colors ".concat("carousel"===I?"bg-foreground text-background":"bg-background hover:bg-foreground/10"),children:"Carousel"}),(0,r.jsx)("button",{onClick:()=>z("grid"),className:"px-3 py-2 text-xs tracking-wide uppercase transition-colors ".concat("grid"===I?"bg-foreground text-background":"bg-background hover:bg-foreground/10"),children:"Grid"})]}),(0,r.jsx)("button",{onClick:()=>S(!0),className:"px-4 py-2 border text-xs tracking-wide uppercase hover:bg-foreground hover:text-background transition-colors",children:"Refine search"}),(0,r.jsx)("button",{onClick:()=>{d(!1),o([]),h(null)},className:"px-6 py-2 border border-foreground text-xs tracking-wide uppercase hover:bg-foreground hover:text-background transition-colors",children:"New Search"})]})]})}),"results"===I?(0,r.jsx)(e_,{initialItems:a,initialUserImage:u,showHeader:!1,onNewSearch:()=>{d(!1),o([]),h(null)}}):"carousel"===I?(0,r.jsx)("div",{className:"max-w-2xl mx-auto",children:(0,r.jsx)(et,{products:a,onProductClick:O})}):(0,r.jsx)("div",{className:"grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 xl:grid-cols-5 gap-6",children:a.map((e,t)=>(0,r.jsxs)("div",{className:"group cursor-pointer",onClick:()=>O(e),onTouchEnd:t=>{t.preventDefault(),O(e)},style:{animationDelay:"".concat(.05*t,"s")},children:[(0,r.jsxs)("div",{className:"aspect-[3/4] relative overflow-hidden bg-muted/20 mb-3 border border-transparent group-hover:border-foreground transition-all duration-300",children:[(0,r.jsx)("img",{src:e.main_image_url,alt:e.title,className:"w-full h-full object-cover transition-transform duration-500 group-hover:scale-110",loading:"lazy"}),(0,r.jsx)("div",{className:"absolute inset-0 bg-foreground/0 group-hover:bg-foreground/5 transition-colors duration-300"}),(0,r.jsx)("div",{className:"absolute top-2 right-2 z-10",children:(0,r.jsx)(Y,{productId:e.id,productTitle:e.title})})]}),(0,r.jsxs)("div",{className:"space-y-1",children:[(0,r.jsx)("h3",{className:"text-[11px] leading-tight line-clamp-2 font-medium",title:e.title,children:e.title}),(0,r.jsx)("div",{children:(0,r.jsx)("p",{className:"text-xs font-bold",children:e.price?"$".concat(e.price.toFixed(2)):"Price N/A"})})]})]},e.id))})]})})]})]}),u&&(c||e)&&(0,r.jsx)("div",{className:"fixed bottom-8 left-8 z-50 animate-in slide-in-from-left duration-700",children:(0,r.jsxs)("div",{className:"group relative",children:[(0,r.jsx)("div",{className:"absolute -inset-1 bg-foreground/10 blur-sm"}),(0,r.jsxs)("div",{className:"relative bg-background border-2 border-foreground p-1",children:[(0,r.jsx)("div",{className:"w-28 h-28 overflow-hidden",children:(0,r.jsx)(W,{src:u,alt:"Search reference"})}),(0,r.jsx)("button",{onClick:()=>h(null),className:"absolute -top-3 -right-3 w-6 h-6 bg-foreground text-background flex items-center justify-center hover:bg-foreground/80 transition-colors","aria-label":"Remove preview",children:(0,r.jsx)(l.Z,{className:"w-3 h-3"})})]}),(0,r.jsx)("div",{className:"mt-2 text-[9px] tracking-[0.15em] uppercase opacity-60",children:"Your Image"})]})}),(0,r.jsx)(P,{isOpen:k,onClose:()=>S(!1),lastEmbedding:b,lastModel:w,onResults:e=>{o((e||[]).map(e=>{var t;return{...e,title:e.title||"Untitled",score:null!==(t=e.similarity)&&void 0!==t?t:void 0!==e.cos_distance?1-e.cos_distance:.5}})),d(!0)}})]})}},2595:function(e,t,a){"use strict";a.d(t,{z:function(){return c}});var r=a(7437),s=a(2265),n=a(7053),i=a(535),l=a(2835);let o=(0,i.j)("inline-flex items-center justify-center gap-2 whitespace-nowrap text-sm font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring disabled:pointer-events-none disabled:opacity-50 [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0",{variants:{variant:{default:"bg-primary text-primary-foreground hover:bg-primary/80 transition-colors",destructive:"bg-destructive text-destructive-foreground hover:bg-destructive/90",outline:"border border-primary bg-background hover:bg-primary hover:text-primary-foreground transition-colors",secondary:"bg-secondary text-secondary-foreground hover:bg-secondary/80",ghost:"hover:bg-accent hover:text-accent-foreground",link:"text-primary underline-offset-4 hover:underline"},size:{default:"h-10 px-4 py-2",sm:"h-9 px-3",lg:"h-11 px-8",icon:"h-10 w-10"}},defaultVariants:{variant:"default",size:"default"}}),c=s.forwardRef((e,t)=>{let{className:a,variant:s,size:i,asChild:c=!1,...d}=e,u=c?n.g7:"button";return(0,r.jsx)(u,{className:(0,l.cn)(o({variant:s,size:i,className:a})),ref:t,...d})});c.displayName="Button"},9026:function(e,t,a){"use strict";a.d(t,{AuthProvider:function(){return l},a:function(){return o}});var r=a(7437),s=a(2265),n=a(781);let i=(0,s.createContext)({user:null,session:null,loading:!0,signIn:async()=>({error:null}),signUp:async()=>({error:null}),signOut:async()=>{}});function l(e){let{children:t}=e,[a,l]=(0,s.useState)(null),[o,c]=(0,s.useState)(null),[d,u]=(0,s.useState)(!0);(0,s.useEffect)(()=>{let{data:{subscription:e}}=n.O.auth.onAuthStateChange((e,t)=>{var a;c(t),l(null!==(a=null==t?void 0:t.user)&&void 0!==a?a:null),u(!1)});return n.O.auth.getSession().then(e=>{var t;let{data:{session:a}}=e;c(a),l(null!==(t=null==a?void 0:a.user)&&void 0!==t?t:null),u(!1)}),()=>e.unsubscribe()},[]);let h=async(e,t)=>{let{error:a}=await n.O.auth.signInWithPassword({email:e,password:t});return a||(window.location.href="/"),{error:a}},m=async(e,t,a)=>{let r="".concat(window.location.origin,"/"),{error:s}=await n.O.auth.signUp({email:e,password:t,options:{emailRedirectTo:r,data:{display_name:a}}});return{error:s}},g=async()=>{await n.O.auth.signOut()};return(0,r.jsx)(i.Provider,{value:{user:a,session:o,loading:d,signIn:h,signUp:m,signOut:g},children:t})}let o=()=>{let e=(0,s.useContext)(i);if(!e)throw Error("useAuth must be used within an AuthProvider");return e}},781:function(e,t,a){"use strict";a.d(t,{O:function(){return r}});let r=(0,a(1545).eI)("https://veikyjfcycgpkpwdbksa.supabase.co","eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InZlaWt5amZjeWNncGtwd2Ria3NhIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTQwMjA0OTAsImV4cCI6MjA2OTU5NjQ5MH0.xPFTAJVSpVS4hcbnzmILDItpSphcP2aKTPSFo1VbB2s",{auth:{storage:localStorage,persistSession:!0,autoRefreshToken:!0}})},2835:function(e,t,a){"use strict";a.d(t,{cn:function(){return n}});var r=a(1994),s=a(3335);function n(){for(var e=arguments.length,t=Array(e),a=0;a<e;a++)t[a]=arguments[a];return(0,s.m6)((0,r.W)(t))}},3298:function(e,t,a){"use strict";a.d(t,{I:function(){return n},j:function(){return i}});var r=a(6214);let s="phc_g5kuTiRTvpi9mxbyUxW0vPgD1Z1fF2ZcxeOBCK6i0Fy";function n(){s&&(window.__PH_INITIALIZED__||(r.ZP.init(s,{api_host:"https://us.i.posthog.com",capture_pageview:!0,capture_pageleave:!0,person_profiles:"identified_only",autocapture:!1}),window.__PH_INITIALIZED__=!0,window.posthog=r.ZP))}function i(e,t){try{r.ZP.capture(e,t)}catch(e){}}}},function(e){e.O(0,[878,545,80,303,971,117,744],function(){return e(e.s=5830)}),_N_E=e.O()}]);